{% extends "pages/home.html" %}
{% load static %}
{% block extrahead %}
{{ form.media}}
{% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static 'public/table.css' %}">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs/dt-1.13.1/datatables.min.css" />
<script type="text/javascript" src="https://cdn.datatables.net/v/bs/dt-1.13.1/datatables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js" defer></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
<link rel="stylesheet" href="{% static 'public/job_profile.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<div style="margin-top: 15px;"> 
<div class="box-body" id="white-box" style="padding-left: 30px;box-sizing: border-box;">
    <form id="downloadForm">
    <div class="col-sm-3 col-md-3">
        <div class="form-group">
            <label for="Type">Type</label>
            <br>
            <select name="fname" id="Type" style="width: 155px; height: 24px; font-size: 11px;">
                <option value="2">chalan</option>
                <option value="1">user</option>
                <option value="0">product</option>
            </select>
        </div>
    </div>
    
    <div class="col-sm-3 col-md-3">
        <div class="form-group">
            <label for="fname">id</label>
            <div id="idInputContainer">
                <input type="text" id="id" name="fname" placeholder="id">
            </div>
            <div id="idDropdownContainer" style="display: none;">
                <select id="idDropdown">
                    {% for list in data %}
                    <option value="{{list.id}}">{{list.name}}</option>
                    {% endfor %}
                </select>
                
            </div>
            <br><br>
        </div>
    </div>
    
    <script>
    document.getElementById('Type').addEventListener('change', function() {
        var selectedValue = this.value;
        var idInputContainer = document.getElementById('idInputContainer');
        var idDropdownContainer = document.getElementById('idDropdownContainer');
        
        if (selectedValue === '0') { // "user" option value is "1"
            idInputContainer.style.display = 'none';
            idDropdownContainer.style.display = 'block';
        } else {
            idInputContainer.style.display = 'block';
            idDropdownContainer.style.display = 'none';
        }
    });
    </script>
   <br><br><br><br>
    <div class="col-sm-3 col-md-3">
        <button onclick="fund_search_list()">Search</button>
    </div>
    <div class="col-sm-3 col-md-3">
        <button type="submit">Download</button>
    </div>
</div>
</form>

<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>

    document.addEventListener("DOMContentLoaded", function() {
        const downloadForm = document.getElementById("downloadForm");

        downloadForm.addEventListener("submit", function(event) {
            event.preventDefault(); // Prevent form submission
            console.log("dsaaaaaaaaaaaaaaaaaaaaa")
            const idValue = document.getElementById("id").value;
            const Type = document.getElementById("Type").value;
            const idDropdown = document.getElementById("idDropdown").value;

            const downloadUrl = `{% url 'download_excel' %}?id=${idValue}&Type=${Type}&idDropdown=${idDropdown}`;

            // Make an AJAX request to the download URL
            fetch(downloadUrl)
                .then(response => response.text())
                .then(csvContent => {
                    const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8" });
                    saveAs(blob, "data.csv");
                });
        });
    });
</script>
{% if type == "0" %}
    <table id="example" class="table-hover" style="height:10px;width:100%">
        <thead>
            <tr>

                <th class="l xl dot">id</th>
                <th class="l xl dot">name</th>
                <th class="l xl dot">price</th>
                <th class="l xl dot">Edit</th>


            </tr>
        </thead>
        <tbody>
            {% for list in page_obj %}
            
            <td class="l xl dot" title="{{list.id}}">{{list.id}}</td>   
            <td class="l xl dot" title="{{list.name}}">{{list.name}}</td>
            <td class="l xl dot" title="{{list.price}}">{{list.price}}</td>
          
                
                <!-- <td class="tbhead vsm c">{{list.Datasheet}}</td> -->
                <!-- {% if "media" in list.datasheet %}
                <td class="Datasheet"><a href="{{list.datasheet}}" target="_blank"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></a></td>
                {% elif list.datasheet == None %}
                <td class="Datasheet"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></td>
                {% elif list.datasheet == "" %}
                <td class="Datasheet"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></td>
                {% else %}
                <td class="Datasheet"><a href="{{list.datasheet}}" target="_blank"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></a></td>
                {% endif %}
                <!-- <td class="edit">{{list.ref}}</td> -->
                
                <td class="edit"><button type="button" onclick=edit({{list.id}})
                    target="_blank">Edit</button></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
    {% if type == "1" %}
    <table id="example" class="table-hover" style="height:10px;width:100%">
        <thead>
            <tr>

                <th class="l xl dot">id</th>
                <th class="l xl dot">name</th>
                <th class="l xl dot">company_name</th>
                <th class="l xl dot">phone_number</th>
                <th class="l xl dot">phone1</th>
                <th class="l xl dot">Edit</th>


            </tr>
        </thead>
        <tbody>
            {% for list in page_obj %}
            
            <td class="l xl dot" title="{{list.id}}">{{list.id}}</td>   
            <td class="l xl dot" title="{{list.name}}">{{list.name}}</td>
            <td class="l xl dot" title="{{list.company_name}}">{{list.company_name}}</td>
            <td class="l xl dot" title="{{list.company_name}}">{{list.phone_number}}</td>
            <td class="l xl dot" title="{{list.company_name}}">{{list.phone1}}</td>
            

                
                <!-- <td class="tbhead vsm c">{{list.Datasheet}}</td> -->
                <!-- {% if "media" in list.datasheet %}
                <td class="Datasheet"><a href="{{list.datasheet}}" target="_blank"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></a></td>
                {% elif list.datasheet == None %}
                <td class="Datasheet"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></td>
                {% elif list.datasheet == "" %}
                <td class="Datasheet"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></td>
                {% else %}
                <td class="Datasheet"><a href="{{list.datasheet}}" target="_blank"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></a></td>
                {% endif %}
                <!-- <td class="edit">{{list.ref}}</td> -->
                
                <td class="edit"><button type="button" onclick=edit({{list.id}})
                    target="_blank">Edit</button></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
    {% if type == "2" %}
    <table id="example" class="table-hover" style="height:10px;width:100%">
        <thead>
            <tr>

                <th class="l xl dot">id</th>
                <th class="l xl dot">chalanno</th>
                <th class="l xl dot">user_id</th>
                <th class="l xl dot">products</th>
                <th class="l xl dot">prices</th>
                <th class="l xl dot">qty</th>
                <th class="l xl dot">rate</th>
                <th class="l xl dot">meter</th>
                <th class="l xl dot">date</th>
                <th class="l xl dot">url</th>
                <th class="l xl dot">Edit</th>
                <th class="l xl dot">Delete</th>
            </tr>
        </thead>
        <tbody>
            {% for list in page_obj %}
            
            <td class="l xl dot" title="{{list.id}}">{{list.id}}</td>   
            <td class="l xl dot" title="{{list.chalanno}}">{{list.chalanno}}</td>
            <td class="l xl dot" title="{{list.user_id}}">{{list.user_id}}</td>
            <td class="l xl dot" title="{{list.products}}">{{list.products}}</td>
            <td class="l xl dot" title="{{list.prices}}">{{list.prices}}</td>
            <td class="l xl dot" title="{{list.qty}}">{{list.qty}}</td>
            <td class="l xl dot" title="{{list.rate}}">{{list.rate}}</td>
            <td class="l xl dot" title="{{list.amount}}">{{list.amount}}</td>
            <td class="l xl dot" title="{{list.date}}">{{list.date}}</td>
            {% if list.url == None %}
            <td class="Datasheet"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></td>
            {% elif list.url == "" %}
                <td class="Datasheet"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></td>
            {% else %}
            <td class="Datasheet"><a href="{{list.url}}" target="_blank"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></a></td>
            {% endif %}  
            
            <!-- <td class="tbhead vsm c">{{list.Datasheet}}</td> -->
                <!-- {% if "media" in list.datasheet %}
                <td class="Datasheet"><a href="{{list.datasheet}}" target="_blank"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></a></td>
                {% elif list.datasheet == None %}
                <td class="Datasheet"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></td>
                {% elif list.datasheet == "" %}
                <td class="Datasheet"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></td>
                {% else %}
                <td class="Datasheet"><a href="{{list.datasheet}}" target="_blank"><i class="fa fa-eye" style=" font-size:20px;color:lightblue;text-shadow:2px 2px 4px #000000;"></i></a></td>
                {% endif %}
                <!-- <td class="edit">{{list.ref}}</td> -->
                
                <td class="edit"><button type="button" onclick=edit({{list.id}})
                    target="_blank">Edit</button></td>
                    <td class="edit"><button type="button" onclick=deletes({{list.id}})
                        target="_blank">Delete</button></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
<div class="pagination" style="float:right; ">
    <span class="step-links">
        {% if page_obj.has_previous %}
        <a id="coloor" href="?page=1">
            << </a>
                <a id="coloor" href="?page={{ page_obj.previous_page_number }}">Previous</a>
                {% endif %}

                <span class="current">
                    {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}
                </span>

                {% if page_obj.has_next %}
                <a id="coloor" href="?page={{ page_obj.next_page_number }}">Next</a>
                <a id="coloor" href="?page={{ page_obj.paginator.num_pages }}">>></a>
                {% endif %}
    </span>
</div>
<style>
    a#coloor {
        background-image: linear-gradient(-180deg, #37AEE2 0%, #1E96C8 100%);
        color: white;
        margin: 0 4px;
        font-size: 14px;
        /* width: 80px; */
        /* height: 60px; */
        padding: 3px 16px;
        border-radius: 8px;
        border: 2px solid black;
    }
    button {
        appearance: none;
        background-image: linear-gradient(-180deg, #37AEE2 0%, #1E96C8 100%);
        border: 2px solid #1A1A1A;
        border-radius: 15px;
        box-sizing: border-box;
        color: #FFFFFF;
        cursor: pointer;
        display: inline-block;
        font-family: Roobert, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        font-size: 12px;
        font-weight: 600;
        line-height: normal;
        margin: 0;
        min-height: 40px;
        min-width: 80px;
        outline: none;
        /* padding: 16px 24px; */
        text-align: center;
        text-decoration: none;
        transition: all 300ms cubic-bezier(.23, 1, 0.32, 1);
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation;
        /* width: 100%; */
        will-change: transform;
    }
    th{
		height: 50px;
		font-size: 12px;
    font-weight: 500;
    padding: 3px 5px;
	}
	td{
		color: #26497F;
    font-size: 12px;
    font-weight: 500;
    padding: 3px 5px;
	}
    div#white-box {
        width: auto;
        background-color: #fff;
        color: #000;
        padding: 8px 12px;
        word-wrap: break-word;
    }
    input,input#fname {
        font-family: inherit;
        display: block !important;
        height: 25px;
        padding: 6px 6px !important;
        font-size: 11px !important;
        line-height: 1.42857143 !important;
        color: #223D4F !important;
        background-color: transparent !important;
        background-image: none !important;
        border: 1px solid #D7DCDE !important;
        border-radius: 0px !important;
        box-shadow: none !important;
        font-size: inherit;
        line-height: inherit;
    }
    label {
        font-size: 11px;
        color: black;
    }
    .form-group {
        margin-top: 6px !important;
        margin-bottom: -30px !important;
    }
    button {
        appearance: none;
        background-image: linear-gradient(-180deg, #37AEE2 0%, #1E96C8 100%);
        border: 2px solid #1A1A1A;
        border-radius: 15px;
        box-sizing: border-box;
        color: #FFFFFF;
        cursor: pointer;
        display: inline-block;
        font-family: Roobert, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        font-size: 12px;
        font-weight: 600;
        line-height: normal;
        margin: 0;
        min-height: 35px;
        min-width: 70px;
        outline: none;
        /* padding: 16px 24px; */
        text-align: center;
        text-decoration: none;
        transition: all 300ms cubic-bezier(.23, 1, 0.32, 1);
        user-select: none;
        -webkit-user-select: none;
        touch-action: manipulation;
        /* width: 100%; */
        will-change: transform;
    }
</style>
</div>
<div id="maintb"></div>
<script>

    document.getElementById('menu').innerHTML = '<span class="dashboard">Find Record</span>'
	document.getElementById('5').className = "active"
	
    var drop_down_val=""
    function download_excel(){
      
        $.ajax({
			url: "{% url 'download_excel' %}",
			data: {
                'id':$("#id").val(),
			'Type': $('#Type').val(),
            'idDropdown': $('#idDropdown').val()
		
			},
			dataType: 'json',
			success: function (data) {
			console.log(data)
		
			
				
				// $("#id_alert").append(make_alert("success","ShareClass added successfully.!"));
				window.alert("Through Data updated successfully.!");
				window.location=document.referrer;
			
			},
			error: function (jqXHR, status, err) {
				console.log(err)
				// $("#id_alert").append(make_alert("danger","Sorry, Something went wrong."));
				window.alert(err);
			},
		});			
        // window.location.href=url;
    }
    function fund_search_list() {
        var url = "{% url 'find_record' %}";
        var search_dict = {};
        
        search_dict['id'] = $("#id").val();
        search_dict['Type'] =$("#Type").val();
        search_dict['idDropdown'] =$("#idDropdown").val();
        url = "?"+"id="+$("#id").val()+"&Type="+document.getElementById("Type").value+"&idDropdown="+document.getElementById("idDropdown").value
        console.log(url)
        window.location.href=url;
        // $.ajax({
        //     url: url,
        //     method: 'GET',
        //     data: search_dict,
        //     success: function (data) {},
        //     error: function (jqXHR, status, err) {
        //         // $("#id_alert").append(make_alert("danger","Sorry, Something went wrong."));
        //         // make_alert("danger", "Sorry, Something went wrong.");
        //     },
        // });
    }
</script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const downloadForm = document.getElementById("downloadForm");

        downloadForm.addEventListener("submit", function(event) {
            event.preventDefault(); // Prevent form submission

            const idValue = document.getElementById("idInput").value;
            const Type = document.getElementById("Type").value;
            const idDropdown = document.getElementById("idDropdown").value;
            
            const downloadUrl = `{% url 'download_excel' %}?id=${idValue}&Type=${Type}&idDropdown=${idDropdown}`;

            // Make an AJAX request to the download URL
            fetch(downloadUrl)
                .then(response => response.text())
                .then(csvContent => {
                    const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8" });
                    saveAs(blob, "data.csv");
                });
        });
    });
</script>
<script>
 function deletes(data){
        bootbox.confirm({
        message: "Are you sure to Delete Data?",
        buttons: {
            confirm: {
                label: 'Yes',
                className: 'btn-success'
            },
            cancel: {
                label: 'No',
                className: 'btn-danger'
            }
        },
        callback: function (result) {
            if(result){
            if ("{{type}}"=="0"){
               
               location.assign("{% url 'delete' %}?id="+data+"&Type=0");
           }
           else if("{{type}}"=="1"){
           
               location.assign("{% url 'delete' %}?id="+data+"&Type=1");}
           else if("{{type}}"=="2") {
              
               location.assign("{% url 'delete' %}?id="+data+"&Type=2");}
                }
           
           }
        });
        }
   function edit(data){
        bootbox.confirm({
        message: "Are you sure to Edit Data?",
        buttons: {
            confirm: {
                label: 'Yes',
                className: 'btn-success'
            },
            cancel: {
                label: 'No',
                className: 'btn-danger'
            }
        },
        callback: function (result) {
            if(result){
            if ("{{type}}"=="0"){
               
               location.assign("{% url 'edit_surface' %}?id="+data);
           }
           else if("{{type}}"=="1"){
           
               location.assign("{% url 'edit_through' %}?id="+data);}
           else if("{{type}}"=="2") {
              
               location.assign("{% url 'edit_other' %}?id="+data);}
                }
           
           }
        });
        }
    $(document).ready(function () {
        $('#example').DataTable({
            scrollX: true,
            aLengthMenu: [
                [25, 25, 50],
                [25, 25, 50]
            ],
            'columnDefs': [{
                'targets': [8],
                'orderable': false,
            }]
        })
        document.getElementById('example_info').hidden=true
        document.getElementById('example_length').hidden=true
        document.getElementById('example_paginate').hidden=true});
</script>
{% endblock %}